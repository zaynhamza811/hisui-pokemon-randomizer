<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hisui Pok√©mon Randomizer</title>
  <style>
    body {
      font-family: 'Courier New', Courier, monospace;
      background: #f6f1e7;
      color: #5b4636;
      margin: 0;
      padding: 20px;
    }
    #score {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #f9f5e7;
      border: 3px solid #c3b091;
      border-radius: 10px;
      padding: 10px 15px;
      box-shadow: 3px 3px 8px rgba(0,0,0,0.2);
      font-size: 14px;
      z-index: 999;
    }
    #resetBtn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: #c3b091cc;
      border: none;
      border-radius: 5px;
      color: #fff;
      font-weight: bold;
      font-family: 'Georgia', serif;
      font-size: 12px;
      padding: 6px 10px;
      cursor: pointer;
      opacity: 0.3;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }
    #resetBtn:hover {
      opacity: 1;
    }
    #caughtToggle {
      position: fixed;
      top: 20px;
      right: 100px;
      background-color: #c3b091cc;
      border: none;
      border-radius: 8px;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      font-family: 'Georgia', serif;
      font-size: 14px;
      padding: 8px 15px;
      z-index: 999;
      transition: background-color 0.3s ease;
    }
    #caughtToggle:hover {
      background-color: #b09c73;
    }
    #caughtList {
      display: none;
      max-height: 250px;
      overflow-y: auto;
      background: #fffef9;
      border: 3px solid #c3b091;
      border-radius: 10px;
      padding: 15px;
      margin-top: 10px;
      font-family: 'Georgia', serif;
      font-size: 14px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
      max-width: 450px;
      margin-left: auto;
      margin-right: auto;
    }
    #caughtList div {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }
    #caughtList img {
      width: 32px;
      height: 32px;
      image-rendering: pixelated;
      margin-right: 8px;
      border-radius: 4px;
      background: #f9f5e7;
    }
    #pokedex {
      max-width: 450px;
      background: #f9f5e7;
      border: 4px solid #c3b091;
      border-radius: 15px;
      box-shadow: 5px 5px 15px rgba(0,0,0,0.2);
      padding: 25px;
      margin: 80px auto 0 auto;
      font-size: 16px;
      line-height: 1.5;
      font-family: 'Georgia', serif;
      text-align: center;
    }
    h1 {
      font-family: 'Georgia', serif;
      font-weight: normal;
      margin-bottom: 20px;
      color: #7b6b4d;
    }
    #pokemonName {
      text-transform: capitalize;
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    #pokemonTypes {
      margin-bottom: 15px;
    }
    .type {
      display: inline-block;
      background: #c3b091;
      border-radius: 12px;
      padding: 5px 12px;
      margin-right: 8px;
      font-weight: bold;
      color: #4a3f2b;
      text-transform: uppercase;
      font-size: 12px;
    }
    #pokemonSprite {
      display: block;
      margin: 0 auto 15px;
      width: 120px;
      height: 120px;
      image-rendering: pixelated;
    }
    .alpha-glow {
      filter: drop-shadow(0 0 6px crimson);
    }
    .shiny-glow {
      filter: drop-shadow(0 0 6px gold);
    }
    .shiny-alpha-glow {
      filter: drop-shadow(0 0 6px crimson) drop-shadow(0 0 6px gold);
    }
    /* Smaller glow for mini sprites in caught list */
    #caughtList img.alpha-glow {
      filter: drop-shadow(0 0 4px crimson);
    }
    #caughtList img.shiny-glow {
      filter: drop-shadow(0 0 4px gold);
    }
    #caughtList img.shiny-alpha-glow {
      filter: drop-shadow(0 0 4px crimson) drop-shadow(0 0 4px gold);
    }
  </style>
</head>
<body>

  <button id="resetBtn" title="Reset progress (all caught Pok√©mon and score)">Reset</button>
  <button id="caughtToggle">Show Caught Pok√©mon</button>
  <div id="score">Score: <span id="scoreValue">0</span> pts</div>

  <div id="pokedex">
    <h1>Hisui Pok√©dex</h1>
    <img id="pokemonSprite" src="" alt="Pokemon Sprite" />
    <div id="pokemonName">Loading...</div>
    <div id="pokemonTypes"></div>
  </div>

  <div id="caughtList"></div>

  <script>
    // Example Pok√©mon starting array (can add more)
    const hisuiPokedex = [
      { name: "basculegion-male", types: ["water", "ghost"] },
      { name: "ursaluna", types: ["ground", "normal"] }
      // Add your full list here...
    ];

    // Load from localStorage or initialize
    let score = parseInt(localStorage.getItem("score")) || 0;
    let caughtPokemons = JSON.parse(localStorage.getItem("caughtPokemons") || "[]");

    const scoreValueElem = document.getElementById("scoreValue");
    const caughtListElem = document.getElementById("caughtList");
    const toggleBtn = document.getElementById("caughtToggle");
    const resetBtn = document.getElementById("resetBtn");
    const spriteElem = document.getElementById("pokemonSprite");
    const nameElem = document.getElementById("pokemonName");
    const typesElem = document.getElementById("pokemonTypes");

    function saveToLocal() {
      localStorage.setItem("score", score.toString());
      localStorage.setItem("caughtPokemons", JSON.stringify(caughtPokemons));
    }

    function getRandomPokemon() {
      if (!hisuiPokedex.length) {
        alert("Pok√©dex is empty or missing!");
        throw new Error("Pok√©dex array is empty.");
      }
      return hisuiPokedex[Math.floor(Math.random() * hisuiPokedex.length)];
    }

    function rollOdds() {
      const roll = Math.floor(Math.random() * 300) + 1;
      if (roll === 1) return "shiny-alpha";
      if (roll <= 3) return "shiny";
      if (roll <= 18) return "alpha";
      return "regular";
    }

    function updateScoreAndCaught(pokemon, variant) {
      let pts = 0, label = "";
      if (variant === "shiny-alpha") { pts = 10; label = "‚ú® Shiny Alpha ‚ú®"; }
      else if (variant === "shiny") { pts = 3; label = "‚≠ê Shiny"; }
      else if (variant === "alpha") { pts = 2; label = "üë∫ Alpha"; }
      else { pts = 1; }

      score += pts;
      scoreValueElem.textContent = score;

      const displayName = pokemon.name.replace(/_/g, " ");
      // Save as object with variant for easier handling
      caughtPokemons.unshift({ name: displayName, variant });
      saveToLocal();
      updateCaughtListWithSprites();
    }

    toggleBtn.addEventListener("click", () => {
      const visible = caughtListElem.style.display === "block";
      caughtListElem.style.display = visible ? "none" : "block";
      toggleBtn.textContent = visible ? "Show Caught Pok√©mon" : "Hide Caught Pok√©mon";
    });

    resetBtn.addEventListener("click", () => {
      if (confirm("Are you sure you want to reset all progress? This will delete your score and all caught Pok√©mon.")) {
        score = 0;
        caughtPokemons = [];
        saveToLocal();
        scoreValueElem.textContent = score;
        updateCaughtListWithSprites();
      }
    });

    async function fetchMiniSprite(pokeName, variant) {
      try {
        const formName = pokeName.toLowerCase();
        const resp = await fetch(`https://pokeapi.co/api/v2/pokemon-form/${formName}`);
        if (!resp.ok) throw new Error("Form not found");
        const data = await resp.json();

        if (variant === "shiny" || variant === "shiny-alpha") {
          return data.sprites.front_shiny || data.sprites.front_default;
        }
        return data.sprites.front_default;
      } catch {
        return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokeName}.png`;
      }
    }

    async function updateCaughtListWithSprites() {
      caughtListElem.innerHTML = "";
      for (const entry of caughtPokemons) {
        const { name: pokeName, variant } = entry;
        const formName = pokeName.toLowerCase().replace(/ /g, "-");
        const spriteUrl = await fetchMiniSprite(formName, variant);

        const div = document.createElement("div");
        const img = document.createElement("img");
        img.src = spriteUrl;
        img.alt = pokeName;

        if (variant === "alpha") img.classList.add("alpha-glow");
        else if (variant === "shiny") img.classList.add("shiny-glow");
        else if (variant === "shiny-alpha") img.classList.add("shiny-alpha-glow");

        div.appendChild(img);
        div.appendChild(document.createTextNode(`${pokeName} ${variantLabel(variant)}`));
        caughtListElem.appendChild(div);
      }
    }

    function variantLabel(variant) {
      switch (variant) {
        case "shiny-alpha": return "‚ú® Shiny Alpha ‚ú®";
        case "shiny": return "‚≠ê Shiny";
        case "alpha": return "üë∫ Alpha";
        default: return "";
      }
    }

    async function loadPokemon() {
      try {
        const pokemon = getRandomPokemon();

        nameElem.textContent = pokemon.name.replace(/_/g, " ");
        typesElem.innerHTML = "";
        pokemon.types.forEach(type => {
          const span = document.createElement("span");
          span.className = "type";
          span.textContent = type;
          typesElem.appendChild(span);
        });

        const variant = rollOdds();
        updateScoreAndCaught(pokemon, variant);

        const formName = pokemon.name.toLowerCase();

        const resp = await fetch(`https://pokeapi.co/api/v2/pokemon-form/${formName}`);
        if (!resp.ok) throw new Error("Form not found");
        const data = await resp.json();

        const shinySrc = data.sprites.front_shiny;
        const defaultSrc = data.sprites.front_default;

        spriteElem.src = (variant === "shiny" || variant === "shiny-alpha")
          ? (shinySrc || defaultSrc || "")
          : (defaultSrc || "");
        spriteElem.alt = `${pokemon.name.replace(/_/g, " ")} sprite`;
        spriteElem.className = "";

        if (variant === "alpha") spriteElem.classList.add("alpha-glow");
        if (variant === "shiny") spriteElem.classList.add("shiny-glow");
        if (variant === "shiny-alpha") spriteElem.classList.add("shiny-alpha-glow");
      } catch (err) {
        console.error("Error loading Pok√©mon:", err);
        nameElem.textContent = "Error loading Pok√©mon.";
        spriteElem.src = "";
        spriteElem.className = "";
      }
    }

    window.onload = () => {
      scoreValueElem.textContent = score;
      updateCaughtListWithSprites();
      loadPokemon();
    };
  </script>
</body>
</html>
